{"Name":"Mark IOCs False Positive","Description":"This action mark multiple IOCs as false positives in Intel Exchange","Script":"from __future__ import annotations\n\nimport json\n\nfrom ScriptResult import EXECUTION_STATE_COMPLETED, EXECUTION_STATE_FAILED\nfrom SiemplifyAction import SiemplifyAction\nfrom SiemplifyUtils import output_handler\n\nfrom api_manager import APIManager\nfrom constants import (\n    COMMON_ACTION_ERROR_MESSAGE,\n    MARK_INDICATOR_FALSE_POSITIVE_SCRIPT_NAME,\n    RESULT_VALUE_FALSE,\n    RESULT_VALUE_TRUE,\n    NO_ENTITIES_ERROR,\n    NO_VALID_IOC_ERROR\n)\nfrom cyware_exceptions import CywareException, ItemNotFoundException\nfrom utils import get_integration_params, string_to_list, get_entities\n\n@output_handler\ndef main():\n    siemplify = SiemplifyAction()\n    siemplify.script_name = MARK_INDICATOR_FALSE_POSITIVE_SCRIPT_NAME\n    siemplify.LOGGER.info(\"----------------- Main - Param Init -----------------\")\n\n    output_message = \"\"\n    status = EXECUTION_STATE_COMPLETED\n    result_value = RESULT_VALUE_FALSE\n    json_results = []\n\n    try:\n        base_url, access_id, secret_key, verify_ssl = get_integration_params(siemplify)\n        entities = get_entities(siemplify)\n\n        siemplify.LOGGER.info(\"----------------- Main - Started -----------------\")\n\n        if not entities:\n            output_message = NO_ENTITIES_ERROR\n            result_value = RESULT_VALUE_TRUE\n            status = EXECUTION_STATE_COMPLETED\n            return\n\n        cyware_manager = APIManager(\n            base_url.strip(), access_id, secret_key, verify_ssl=verify_ssl, siemplify=siemplify\n        )\n\n        siemplify.LOGGER.info(\"Fetching IOC IDs from Names before marking false positive\")\n        siemplify.LOGGER.info(f\"entities {entities}\")\n        ioc_lookup = cyware_manager.lookup_iocs(entities)\n        missing_iocs = [value for value in entities if value not in ioc_lookup]\n        if missing_iocs:\n            siemplify.LOGGER.info(\n                f\"Indicator(s) not found in CTIX and will be skipped: {', '.join(missing_iocs)}\"\n            )\n        valid_iocs = [value for value in entities if value in ioc_lookup]\n        indicator_ids = [ioc_lookup[value] for value in valid_iocs]\n\n        if not indicator_ids:\n            output_message = NO_VALID_IOC_ERROR\n            result_value = RESULT_VALUE_TRUE\n            status = EXECUTION_STATE_COMPLETED\n            return\n\n        object_ids = [ioc_lookup[value] for value in entities]\n\n        response = cyware_manager.mark_indicator_false_positive(\n            object_ids=object_ids\n        )\n\n        if response:\n            json_results = json.dumps(response, indent=4)\n            message = response.get(\"message\", \"\")\n            output_message = f\"Successfully marked {len(object_ids)} indicators as false positive. {message}\"\n            result_value = RESULT_VALUE_TRUE\n            siemplify.LOGGER.info(f\"Mark false positive response: {json.dumps(response)}\")\n        else:\n            output_message = \"Failed to mark indicators as false positive.\"\n            result_value = RESULT_VALUE_FALSE\n\n    except CywareException as e:\n        output_message = str(e)\n        result_value = RESULT_VALUE_FALSE\n        status = EXECUTION_STATE_FAILED\n        siemplify.LOGGER.error(output_message)\n        siemplify.LOGGER.exception(e)\n\n    except Exception as e:\n        output_message = COMMON_ACTION_ERROR_MESSAGE.format(MARK_INDICATOR_FALSE_POSITIVE_SCRIPT_NAME, e)\n        result_value = RESULT_VALUE_FALSE\n        status = EXECUTION_STATE_FAILED\n        siemplify.LOGGER.error(output_message)\n        siemplify.LOGGER.exception(e)\n    \n    finally:\n        siemplify.LOGGER.info(\"----------------- Main - Finished -----------------\")\n        siemplify.result.add_result_json(json_results)\n        siemplify.LOGGER.info(f\"Status: {status}\")\n        siemplify.LOGGER.info(f\"result_value: {result_value}\")\n        siemplify.LOGGER.info(f\"Output Message: {output_message}\")\n        siemplify.end(output_message, result_value, status)\n\n\nif __name__ == \"__main__\":\n    main()\n","IntegrationIdentifier":"CywareIntelExchange","ScriptResultName":"ScriptResult","DynamicResultsMetadata":[{"ResultName":"JsonResult","ResultExample":"{\n    \"message\": \"Action Successfully Executed\"\n}","ShowResult":true}],"Creator":"2ad92bfc-4521-467b-afef-7163569481dc","IsEnabled":true,"IsCustom":true,"AiGenerated":false,"IsSystem":false,"Version":20.0,"TimeoutSeconds":600,"IsAsync":false,"AsyncPollingIntervalInSeconds":3600,"TotalIntervalTimeoutForAsyncInSeconds":86400,"Parameters":[],"DefaultResultValue":"","PythonVersion":"None","ActionType":1,"SimulationData":{"Entities":null},"SimulationDataJson":null}