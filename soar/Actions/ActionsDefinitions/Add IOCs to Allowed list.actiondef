{"Name":"Add IOCs to Allowed list","Description":"This action marks IOCs as allowed list (whitelist).","Script":"from __future__ import annotations\n\nimport json\n\nfrom ScriptResult import EXECUTION_STATE_COMPLETED, EXECUTION_STATE_FAILED\nfrom SiemplifyAction import SiemplifyAction\nfrom SiemplifyUtils import output_handler\n\nfrom api_manager import APIManager\nfrom constants import (\n    ADD_ALLOWED_IOCS_SCRIPT_NAME,\n    COMMON_ACTION_ERROR_MESSAGE,\n    NO_ENTITIES_ERROR,\n    RESULT_VALUE_FALSE,\n    RESULT_VALUE_TRUE,\n)\nfrom cyware_exceptions import CywareException\nfrom utils import get_entities, get_integration_params\n\n\n@output_handler\ndef main():\n    siemplify = SiemplifyAction()\n    siemplify.script_name = ADD_ALLOWED_IOCS_SCRIPT_NAME\n    siemplify.LOGGER.info(\"----------------- Main - Param Init -----------------\")\n\n    output_message = \"\"\n    status = EXECUTION_STATE_COMPLETED\n    result_value = RESULT_VALUE_FALSE\n    json_results = []\n\n    try:\n        base_url, access_id, secret_key, verify_ssl = get_integration_params(siemplify)\n        ioc_type = siemplify.extract_action_param(\"IOC Type\", print_value=True, is_mandatory=True)\n        reason = siemplify.extract_action_param(\"Reason\", print_value=True, is_mandatory=True)\n        entities = get_entities(siemplify)\n        siemplify.LOGGER.info(\"----------------- Main - Started -----------------\")\n\n        if not entities:\n            output_message = NO_ENTITIES_ERROR\n            result_value = RESULT_VALUE_TRUE\n            status = EXECUTION_STATE_COMPLETED\n            return\n\n        cyware_manager = APIManager(\n            base_url.strip(),\n            access_id,\n            secret_key,\n            verify_ssl=verify_ssl,\n            siemplify=siemplify,\n        )\n\n        response = cyware_manager.add_allowed_iocs(\n            ioc_type=ioc_type, values=entities, reason=reason\n        )\n\n        if response:\n            json_results = json.dumps(response, indent=4)\n            details = response.get(\"details\", {})\n            new_created = details.get(\"new_created\", [])\n            already_exists = details.get(\"already_exists\", [])\n            invalid = details.get(\"invalid\", [])\n\n            output_message = f\"Successfully processed {len(entities)} indicators. \"\n            output_message += (\n                f\"New: {len(new_created)}, Already exists: {len(already_exists)}, \"\n                f\"Invalid: {len(invalid)}.\"\n            )\n            result_value = RESULT_VALUE_TRUE\n            siemplify.LOGGER.info(f\"Add IOCs to Allowlist response: {json.dumps(response)}\")\n        else:\n            output_message = \"Failed to Add IOCs to Allowlist.\"\n\n    except CywareException as e:\n        output_message = str(e)\n        status = EXECUTION_STATE_FAILED\n        siemplify.LOGGER.error(output_message)\n        siemplify.LOGGER.exception(e)\n\n    except Exception as e:\n        output_message = COMMON_ACTION_ERROR_MESSAGE.format(ADD_ALLOWED_IOCS_SCRIPT_NAME, e)\n        status = EXECUTION_STATE_FAILED\n        siemplify.LOGGER.error(output_message)\n        siemplify.LOGGER.exception(e)\n\n    finally:\n        siemplify.LOGGER.info(\"----------------- Main - Finished -----------------\")\n        siemplify.LOGGER.info(f\"Status: {status}\")\n        siemplify.LOGGER.info(f\"result_value: {result_value}\")\n        siemplify.LOGGER.info(f\"Output Message: {output_message}\")\n        siemplify.result.add_result_json(json_results)\n        siemplify.end(output_message, result_value, status)\n\n\nif __name__ == \"__main__\":\n    main()\n","IntegrationIdentifier":"CywareIntelExchange","ScriptResultName":"ScriptResult","DynamicResultsMetadata":[{"ResultName":"JsonResult","ResultExample":"{\"details\": {\"invalid\": [\"35.73.7.2\", \"billing@global-shipping-service.com\", \"https://www.nationstates.net/page=private_info\", \"00:1b:44:11:3a:b7\"], \"new_created\": [\"0-2345.com\"], \"already_exists\": [\"dlptest.com\"]}}","ShowResult":true}],"Creator":"2ad92bfc-4521-467b-afef-7163569481dc","IsEnabled":true,"IsCustom":true,"AiGenerated":false,"IsSystem":false,"Version":1.0,"TimeoutSeconds":600,"IsAsync":false,"AsyncPollingIntervalInSeconds":3600,"TotalIntervalTimeoutForAsyncInSeconds":86400,"Parameters":[{"CustomActionId":0,"IsMandatory":true,"DefaultValue":"ipv4-addr","Description":"Pass the type of indicator.","Name":"IOC Type","Value":"ipv4-addr","Type":15,"OptionalValues":["ipv4-addr","domain-name","ipv6-addr","url","autonomous-system","email-addr","file","MD5","network-traffic","SHA-1","SHA-224","SHA-256","SHA-384","SHA-512","SSDEEP","windows-registry-key","artifact","directory","email-message","mac-addr","mutex","process","SHA3-224","SHA3-256","SHA3-384","SHA3-512","software","user-account","x509-certificate","yara"],"OptionalValuesJson":"[\"ipv4-addr\",\"domain-name\",\"ipv6-addr\",\"url\",\"autonomous-system\",\"email-addr\",\"file\",\"MD5\",\"network-traffic\",\"SHA-1\",\"SHA-224\",\"SHA-256\",\"SHA-384\",\"SHA-512\",\"SSDEEP\",\"windows-registry-key\",\"artifact\",\"directory\",\"email-message\",\"mac-addr\",\"mutex\",\"process\",\"SHA3-224\",\"SHA3-256\",\"SHA3-384\",\"SHA3-512\",\"software\",\"user-account\",\"x509-certificate\",\"yara\"]"},{"CustomActionId":0,"IsMandatory":true,"DefaultValue":"Allow IOCs from Google Secops","Description":"Pass a reason for adding the indicators to the allowed list.","Name":"Reason","Value":"Allow IOCs from Google Secops","Type":0,"OptionalValues":null,"OptionalValuesJson":null}],"DefaultResultValue":"","PythonVersion":"None","ActionType":1,"SimulationData":{"Entities":[]},"SimulationDataJson":"{\"Entities\": []}"}