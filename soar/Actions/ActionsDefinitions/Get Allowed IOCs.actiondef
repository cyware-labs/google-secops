{"Name":"Get Allowed IOCs","Description":"This action retrieves IOCs that are marked as allowed (whitelisted).","Script":"from __future__ import annotations\n\nimport json\n\nfrom ScriptResult import EXECUTION_STATE_COMPLETED, EXECUTION_STATE_FAILED\nfrom SiemplifyAction import SiemplifyAction\nfrom SiemplifyUtils import output_handler, construct_csv\n\nfrom api_manager import APIManager\nfrom constants import (\n    COMMON_ACTION_ERROR_MESSAGE,\n    GET_ALLOWED_IOCS_SCRIPT_NAME,\n    MAX_TABLE_RECORDS,\n    RESULT_VALUE_FALSE,\n    RESULT_VALUE_TRUE,\n)\nfrom cyware_exceptions import CywareException, InvalidIntegerException\nfrom utils import get_integration_params, validate_integer_param\nimport datamodels\n\n\n@output_handler\ndef main():\n    siemplify = SiemplifyAction()\n    siemplify.script_name = GET_ALLOWED_IOCS_SCRIPT_NAME\n    siemplify.LOGGER.info(\"----------------- Main - Param Init -----------------\")\n\n    output_message = \"\"\n    status = EXECUTION_STATE_COMPLETED\n    result_value = RESULT_VALUE_FALSE\n    results_json = []\n\n    try:\n        base_url, access_id, secret_key, verify_ssl = get_integration_params(siemplify)\n        ioc_type = siemplify.extract_action_param(\"IOC Type\", print_value=True)\n        created_from_str = siemplify.extract_action_param(\"Created From\", print_value=True)\n        \n        siemplify.LOGGER.info(\"----------------- Main - Started -----------------\")\n\n        created_from = validate_integer_param(created_from_str, \"Created From\",\n                                               zero_allowed=True) if created_from_str else None\n        cyware_manager = APIManager(\n            base_url.strip(), access_id, secret_key, verify_ssl=verify_ssl, siemplify=siemplify\n        )\n\n        response = cyware_manager.get_allowed_iocs(\n            ioc_type=ioc_type,\n            created_from=created_from\n        )\n\n        results = response.get(\"results\", [])\n        total = response.get(\"total\", 0)\n\n        if results:\n            results_json = json.dumps(response, indent=4)\n            allowed_iocs = [datamodels.AllowedIOC(ioc) for ioc in results]\n            csv_output = [ioc.to_csv() for ioc in allowed_iocs]\n\n            if len(csv_output) > MAX_TABLE_RECORDS:\n                csv_output = csv_output[:MAX_TABLE_RECORDS]\n                output_message = (\n                    f\"Successfully retrieved {len(results)} allowed IOCs (Total: {total}). \"\n                    f\"Showing first {MAX_TABLE_RECORDS} records in table.\"\n                )\n            else:\n                output_message = f\"Successfully retrieved {len(results)} allowed IOCs (Total: {total}).\"\n\n            siemplify.result.add_data_table(\"Allowed IOCs\", construct_csv(csv_output), \"CTIX\")\n            result_value = RESULT_VALUE_TRUE\n            siemplify.LOGGER.info(f\"Retrieved {len(results)} allowed IOCs\")\n        else:\n            output_message = \"No allowed IOCs found.\"\n            result_value = RESULT_VALUE_TRUE\n\n    except InvalidIntegerException as e:\n        output_message = str(e)\n        result_value = RESULT_VALUE_FALSE\n        status = EXECUTION_STATE_FAILED\n        siemplify.LOGGER.error(output_message)\n        siemplify.LOGGER.exception(e)\n\n    except CywareException as e:\n        output_message = str(e)\n        result_value = RESULT_VALUE_FALSE\n        status = EXECUTION_STATE_FAILED\n        siemplify.LOGGER.error(output_message)\n        siemplify.LOGGER.exception(e)\n\n    except Exception as e:\n        output_message = COMMON_ACTION_ERROR_MESSAGE.format(GET_ALLOWED_IOCS_SCRIPT_NAME, e)\n        result_value = RESULT_VALUE_FALSE\n        status = EXECUTION_STATE_FAILED\n        siemplify.LOGGER.error(output_message)\n        siemplify.LOGGER.exception(e)\n    \n    finally:\n        siemplify.LOGGER.info(\"----------------- Main - Finished -----------------\")\n        siemplify.result.add_result_json(results_json)\n        siemplify.LOGGER.info(f\"Status: {status}\")\n        siemplify.LOGGER.info(f\"result_value: {result_value}\")\n        siemplify.LOGGER.info(f\"Output Message: {output_message}\")\n        siemplify.end(output_message, result_value, status)\n\n\nif __name__ == \"__main__\":\n    main()\n","IntegrationIdentifier":"CywareIntelExchange","ScriptResultName":"ScriptResult","DynamicResultsMetadata":[{"ResultName":"JsonResult","ResultExample":"{\n    \"next\": null,\n    \"page_size\": 100,\n    \"previous\": null,\n    \"results\": [\n        {\n            \"created\": 1769755440,\n            \"created_by\": {\n                \"email\": \"anish.jain@crestdata.ai\",\n                \"first_name\": \"Anish\",\n                \"id\": \"8095d3e5-07b8-4478-b89f-4e75af497173\",\n                \"last_name\": \"Jain\"\n            },\n            \"id\": \"0c5e6e0f-5c3e-4d51-9430-7329e44688da\",\n            \"include_emails\": false,\n            \"include_subdomains\": false,\n            \"include_urls\": false,\n            \"modified\": 1769755440,\n            \"modified_by\": {\n                \"email\": \"anish.jain@crestdata.ai\",\n                \"first_name\": \"Anish\",\n                \"id\": \"8095d3e5-07b8-4478-b89f-4e75af497173\",\n                \"last_name\": \"Jain\"\n            },\n            \"type\": \"url\",\n            \"value\": \"185.247.137.203\"\n        },\n        {\n            \"created\": 1769755440,\n            \"created_by\": {\n                \"email\": \"anish.jain@crestdata.ai\",\n                \"first_name\": \"Anish\",\n                \"id\": \"8095d3e5-07b8-4478-b89f-4e75af497173\",\n                \"last_name\": \"Jain\"\n            },\n            \"id\": \"f65dce0d-771a-447c-a57b-cc0054d3756c\",\n            \"include_emails\": false,\n            \"include_subdomains\": false,\n            \"include_urls\": false,\n            \"modified\": 1769755440,\n            \"modified_by\": {\n                \"email\": \"anish.jain@crestdata.ai\",\n                \"first_name\": \"Anish\",\n                \"id\": \"8095d3e5-07b8-4478-b89f-4e75af497173\",\n                \"last_name\": \"Jain\"\n            },\n            \"type\": \"url\",\n            \"value\": \"http.google.com\"\n        },\n        {\n            \"created\": 1767766762,\n            \"created_by\": {\n                \"email\": \"dhruvil.bhatt@crestdata.ai\",\n                \"first_name\": \"dhruvil\",\n                \"id\": \"011ab7cf-4941-4c02-b50f-320186957999\",\n                \"last_name\": \"bhatt\"\n            },\n            \"id\": \"b4454d55-0225-4880-bf03-e67a83f25e49\",\n            \"include_emails\": false,\n            \"include_subdomains\": false,\n            \"include_urls\": false,\n            \"modified\": 1769755440,\n            \"modified_by\": {\n                \"email\": \"anish.jain@crestdata.ai\",\n                \"first_name\": \"Anish\",\n                \"id\": \"8095d3e5-07b8-4478-b89f-4e75af497173\",\n                \"last_name\": \"Jain\"\n            },\n            \"type\": \"url\",\n            \"value\": \"https://www.cloudflare.com/5xx-error-landing\"\n        }\n    ],\n    \"total\": 3\n}","ShowResult":true}],"Creator":"2ad92bfc-4521-467b-afef-7163569481dc","IsEnabled":true,"IsCustom":true,"AiGenerated":false,"IsSystem":false,"Version":23.0,"TimeoutSeconds":600,"IsAsync":false,"AsyncPollingIntervalInSeconds":3600,"TotalIntervalTimeoutForAsyncInSeconds":86400,"Parameters":[{"CustomActionId":0,"IsMandatory":false,"DefaultValue":"All","Description":"Pass an allowed indicator type to filter the result. Select All for visualizing all indicators.","Name":"IOC Type","Value":"All","Type":15,"OptionalValues":["All","artifact","autonomous-system","directory","domain-name","email-addr","email-message","file","ipv6-addr","mac-addr","MD5","mutex","network-traffic","process","SHA-1","SHA-224","SHA-256","SHA-384","SHA-512","SHA3-224","SHA3-256","SHA3-384","SHA3-512","software","SSDEEP","url","user-account","windows-registry-key","x509-certificate","yara","ipv4-addr"],"OptionalValuesJson":"[\"All\",\"artifact\",\"autonomous-system\",\"directory\",\"domain-name\",\"email-addr\",\"email-message\",\"file\",\"ipv6-addr\",\"mac-addr\",\"MD5\",\"mutex\",\"network-traffic\",\"process\",\"SHA-1\",\"SHA-224\",\"SHA-256\",\"SHA-384\",\"SHA-512\",\"SHA3-224\",\"SHA3-256\",\"SHA3-384\",\"SHA3-512\",\"software\",\"SSDEEP\",\"url\",\"user-account\",\"windows-registry-key\",\"x509-certificate\",\"yara\",\"ipv4-addr\"]"},{"CustomActionId":0,"IsMandatory":false,"DefaultValue":"","Description":"Pass the created from time in epoch format in seconds to filter records based on the created time. eg. 1767160932","Name":"Created From","Value":"","Type":0,"OptionalValues":null,"OptionalValuesJson":null}],"DefaultResultValue":"","PythonVersion":"None","ActionType":1,"SimulationData":{"Entities":null},"SimulationDataJson":null}